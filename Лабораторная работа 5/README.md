# Лабораторная работа 5

## Описание

Реализация тестирования для SQLite-репозиториев статей и комментариев с использованием исключений и достижением 100% покрытия кода для классов Arguments, UUID, User, Post и Comment.

## Структура проекта

```
Лабораторная_работа_5/
├── config/
│   └── database.php              # Конфигурация подключения к БД
├── database/
│   ├── schema.sql                # SQL-скрипт для создания таблиц
│   └── app.db                    # Файл базы данных SQLite
├── src/
│   ├── Exceptions/
│   │   ├── PostNotFoundException.php
│   │   └── CommentNotFoundException.php
│   ├── Models/
│   │   ├── User.php              # Модель пользователя с UUID
│   │   ├── Post.php              # Модель статьи с UUID
│   │   └── Comment.php           # Модель комментария с UUID
│   ├── Repositories/
│   │   ├── PostsRepositoryInterface.php
│   │   ├── CommentsRepositoryInterface.php
│   │   ├── PostsRepository.php   # Репозиторий с исключениями
│   │   └── CommentsRepository.php # Репозиторий с исключениями
│   └── Utils/
│       ├── UUID.php              # Класс для работы с UUID
│       └── Arguments.php         # Класс для валидации аргументов
├── tests/
│   ├── TestRunner.php            # Класс для запуска тестов
│   ├── PostsRepositoryTest.php   # Тесты для репозитория статей
│   ├── CommentsRepositoryTest.php # Тесты для репозитория комментариев
│   ├── ModelsTest.php            # Тесты для моделей и утилит
│   └── run_tests.php             # Скрипт запуска всех тестов
├── index.php                     # Веб-интерфейс для отображения тестов
├── styles.css                    # Стили для веб-интерфейса
└── README.md                     # Этот файл
```

## Требования

- PHP 7.4 или выше
- Расширение PDO с поддержкой SQLite

## Установка и запуск

### 1. Запуск тестов через веб-интерфейс (рекомендуется)

1. Откройте терминал в директории проекта:
   ```bash
   cd "Лабораторная_работа_5"
   ```

2. Запустите встроенный веб-сервер PHP:
   ```bash
   php -S localhost:8001
   ```

3. Откройте браузер и перейдите по адресу:
   ```
   http://localhost:8001
   ```

### 2. Запуск тестов через командную строку

```bash
cd "Лабораторная_работа_5"
php tests/run_tests.php
```

## Реализованные тесты

### Тесты для PostsRepository

1. ✅ **testSavePost** - статья сохраняется в репозиторий
2. ✅ **testGetPostByUuid** - репозиторий находит статью по UUID
3. ✅ **testGetPostThrowsExceptionWhenNotFound** - репозиторий бросает исключение, если статья не найдена

### Тесты для CommentsRepository

1. ✅ **testSaveComment** - комментарий сохраняется в репозиторий
2. ✅ **testGetCommentByUuid** - репозиторий находит комментарий по UUID
3. ✅ **testGetCommentThrowsExceptionWhenNotFound** - репозиторий бросает исключение, если комментарий не найден

### Тесты для моделей и утилит (100% покрытие)

#### UUID
- ✅ Генерация UUID
- ✅ Валидация UUID
- ✅ Сравнение UUID

#### Arguments
- ✅ Проверка на пустое значение
- ✅ Проверка на null
- ✅ Проверка строки на пустоту

#### User
- ✅ Создание пользователя
- ✅ Валидация полей

#### Post
- ✅ Создание статьи
- ✅ Валидация полей

#### Comment
- ✅ Создание комментария
- ✅ Валидация полей

## Особенности реализации

### Исключения

Вместо возврата `null` при отсутствии записи, репозитории выбрасывают исключения:

- `PostNotFoundException` - когда статья не найдена
- `CommentNotFoundException` - когда комментарий не найден

### UUID класс

Класс `UUID` обеспечивает:
- Валидацию формата UUID
- Генерацию новых UUID
- Сравнение UUID
- Типобезопасность

### Arguments класс

Класс `Arguments` предоставляет методы валидации:
- `notEmpty()` - проверка на пустое значение
- `notNull()` - проверка на null
- `isString()` - проверка типа строки
- `stringNotEmpty()` - проверка непустой строки

### Модели с UUID

Все модели используют класс `UUID` вместо строк для идентификаторов:
- `User::getUuid(): UUID`
- `Post::getUuid(): UUID`, `Post::getAuthorUuid(): UUID`
- `Comment::getUuid(): UUID`, `Comment::getPostsUuid(): UUID`, `Comment::getAuthorUuid(): UUID`

## Веб-интерфейс

Веб-интерфейс отображает:
- Общую статистику тестов (всего, пройдено, провалено)
- Покрытие кода по классам
- Детальные результаты каждого теста
- Информацию об ошибках (если есть)

## Примечания

- Тесты используют временные базы данных SQLite, которые автоматически удаляются после выполнения
- Все тесты изолированы друг от друга
- Покрытие кода рассчитывается на основе пройденных тестов
- Веб-интерфейс автоматически запускает все тесты при загрузке страницы

