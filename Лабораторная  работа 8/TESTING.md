# Инструкция по тестированию лабораторной работы 8

## Что обратить внимание при тестировании

### 1. Логирование операций сохранения (INFO)

**Что проверить:**
- При создании пользователя в логах должна появиться запись уровня **INFO** с UUID пользователя
- При создании статьи в логах должна появиться запись уровня **INFO** с UUID статьи
- При создании комментария в логах должна появиться запись уровня **INFO** с UUID комментария
- При создании лайка статьи в логах должна появиться запись уровня **INFO** с UUID лайка
- При создании лайка комментария в логах должна появиться запись уровня **INFO** с UUID лайка комментария

**Формат логов:**
```
[2024-01-15 10:30:45] [INFO] User saved: 550e8400-e29b-41d4-a716-446655440001
[2024-01-15 10:30:46] [INFO] Post saved: 660e8400-e29b-41d4-a716-446655440001
[2024-01-15 10:30:47] [INFO] Comment saved: 770e8400-e29b-41d4-a716-446655440001
[2024-01-15 10:30:48] [INFO] Post like saved: 880e8400-e29b-41d4-a716-446655440001
[2024-01-15 10:30:49] [INFO] Comment like saved: 990e8400-e29b-41d4-a716-446655440001
```

### 2. Логирование отсутствующих объектов (WARNING)

**Что проверить:**
- При попытке получить несуществующего пользователя должна появиться запись уровня **WARNING** с UUID
- При попытке получить несуществующую статью должна появиться запись уровня **WARNING** с UUID
- При попытке получить несуществующий комментарий должна появиться запись уровня **WARNING** с UUID

**Формат логов:**
```
[2024-01-15 10:31:00] [WARNING] User not found: 550e8400-e29b-41d4-a716-446655440999
[2024-01-15 10:31:01] [WARNING] Post not found: 660e8400-e29b-41d4-a716-446655440999
[2024-01-15 10:31:02] [WARNING] Comment not found: 770e8400-e29b-41d4-a716-446655440999
```

### 3. Тестирование через веб-интерфейс

**Шаги для проверки:**

1. **Инициализация данных:**
   ```bash
   php init_test_data.php
   ```
   Это создаст тестовых пользователей, статьи, комментарии и лайки.

2. **Откройте веб-интерфейс:**
   - Запустите сервер: `start-server.bat`
   - Откройте: http://localhost:8000

3. **Проверьте вкладку "Логи":**
   - Должны отображаться все логи операций
   - Проверьте фильтрацию по уровням (INFO, WARNING)
   - Убедитесь, что UUID присутствуют в сообщениях

4. **Проверьте вкладку "Данные":**
   - Должны отображаться созданные пользователи, статьи, комментарии
   - Проверьте корректность отображения данных

5. **Проверьте вкладку "Тестирование":**
   - Нажмите кнопки для создания новых объектов
   - Проверьте, что в логах появляются новые записи INFO
   - Нажмите "Получить несуществующий объект" - должна появиться запись WARNING

### 4. Модульные тесты

**Запуск тестов:**
```bash
php tests/run_tests.php
```

**Что проверяют тесты:**
- ✅ `UsersRepository save logs INFO` - проверяет, что при сохранении пользователя логируется INFO с UUID
- ✅ `UsersRepository get not found logs WARNING` - проверяет, что при отсутствии пользователя логируется WARNING с UUID
- ✅ `PostsRepository save logs INFO` - проверяет логирование при сохранении статьи
- ✅ `PostsRepository get not found logs WARNING` - проверяет логирование при отсутствии статьи
- ✅ `CommentsRepository save logs INFO` - проверяет логирование при сохранении комментария
- ✅ `CommentsRepository get not found logs WARNING` - проверяет логирование при отсутствии комментария
- ✅ `LikesRepository save logs INFO` - проверяет логирование при сохранении лайка статьи
- ✅ `CommentLikesRepository save logs INFO` - проверяет логирование при сохранении лайка комментария

**Важно:** Все тесты используют `TestLogger`, который не записывает в файл, а хранит логи в памяти для проверки.

### 5. Проверка файла логов

**Расположение:** `logs/app.log`

**Что проверить:**
- Файл должен создаваться автоматически
- Все записи должны содержать timestamp, уровень и сообщение
- UUID должны присутствовать в сообщениях
- Формат должен быть: `[timestamp] [LEVEL] message`

### 6. Критерии успешного тестирования

✅ **Все репозитории логируют INFO при save():**
- UsersRepository
- PostsRepository
- CommentsRepository
- LikesRepository
- CommentLikesRepository

✅ **Репозитории с методом get() логируют WARNING при отсутствии объекта:**
- UsersRepository
- PostsRepository
- CommentsRepository

✅ **Все модульные тесты проходят:**
- 8 тестов должны пройти успешно
- TestLogger используется для проверки логов

✅ **Веб-интерфейс отображает логи:**
- Логи загружаются и отображаются
- Фильтрация по уровням работает
- Автообновление работает (каждые 5 секунд)

✅ **Файл логов создается и заполняется:**
- Файл `logs/app.log` существует
- Логи записываются в правильном формате
- UUID присутствуют в сообщениях

### 7. Типичные проблемы и решения

**Проблема:** Логи не отображаются
- **Решение:** Проверьте, что файл `logs/app.log` существует и доступен для чтения

**Проблема:** Тесты не проходят
- **Решение:** Убедитесь, что используется `TestLogger` в тестах, а не `FileLogger`

**Проблема:** Ошибка "Unexpected token '<'"
- **Решение:** Проверьте, что все API endpoints возвращают JSON, а не HTML

**Проблема:** Логи не записываются
- **Решение:** Проверьте права доступа к директории `logs/` и файлу `logs/app.log`

### 8. Дополнительные проверки

- Проверьте, что при создании нескольких объектов подряд все операции логируются
- Проверьте, что логи не дублируются
- Проверьте, что timestamp в логах корректный
- Проверьте, что UUID в логах соответствуют реальным UUID объектов

